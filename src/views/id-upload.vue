<style scoped lang="less">
.preset-card-page {
    width: 100%;
    min-height: 100vh;
    background: #f5f7fa;
    padding-bottom: 40px;
    user-select: none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: transparent;
}

.header {
    background: #fff;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    align-items: center;

    .back-btn {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        margin-right: 12px;
        border-radius: 50%;
        transition: background 0.2s;

        &:active {
            background: rgba(0, 0, 0, 0.05);
        }

        svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }
    }

    .header-title {
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
        flex: 1;
    }
}

.card-detail-section {
    margin: 20px 16px;
    background: #fff;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);

    .category-tag {
        display: inline-block;
        background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        color: #fff;
        font-size: 12px;
        padding: 6px 14px;
        border-radius: 12px;
        font-weight: 500;
        margin-bottom: 16px;
    }

    .card-image-large {
        width: 100%;
        max-width: 400px;
        height: auto;
        border-radius: 12px;
        margin: 0 auto 24px;
        display: block;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    .card-title {
        font-size: 22px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 12px;
    }

    .card-description {
        font-size: 15px;
        color: #666;
        line-height: 1.6;
        margin-bottom: 24px;
    }

    .benefits-section {
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid #eee;

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 16px;
        }

        .benefits-list {
            list-style: none;
            padding: 0;
            margin: 0;

            li {
                padding: 12px 0;
                padding-left: 28px;
                position: relative;
                font-size: 14px;
                color: #333;
                line-height: 1.6;

                &::before {
                    content: '‚úì';
                    position: absolute;
                    left: 0;
                    top: 12px;
                    width: 20px;
                    height: 20px;
                    background: #4caf50;
                    color: #fff;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    font-weight: bold;
                }
            }
        }
    }
}

.application-form {
    // margin: 20px 16px;
    // border-radius: 16px;
    // padding: 24px;
    // box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
background: #f5f7fa;
    .form-title {
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
    }

    .form-group {
        // margin: 0 16px 10px;
        background: #fff;
        padding: 16px;

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;

            .required {
                color: #e53935;
                margin-left: 4px;
            }

            .info-icon {
                display: inline-block;
                width: 16px;
                height: 16px;
                margin-left: 4px;
                border-radius: 50%;
                background: #e0e0e0;
                color: #666;
                font-size: 12px;
                text-align: center;
                line-height: 16px;
                cursor: help;
            }
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
            background: #fff;
            box-sizing: border-box;
            transition: border-color 0.3s;

            &:focus {
                outline: none;
                border-color: #409EFF;
            }

            &::placeholder {
                color: #999;
            }
        }

        textarea {
            min-height: 60px;
            resize: vertical;
        }

        .error-message {
            color: #e53935;
            font-size: 12px;
            margin-top: 4px;
        }

        .date-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;

            input {
                padding-right: 40px;
            }

            .arrow-icon {
                position: absolute;
                right: 16px;
                width: 20px;
                height: 20px;
                pointer-events: none;
                color: #999;
            }
        }

        .verify-code-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-start;

            input {
                flex: 1;
            }

            .get-code-btn {
                padding: 12px 20px;
                background: #fff;
                border: 1px solid #e53935;
                border-radius: 8px;
                color: #e53935;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                white-space: nowrap;
                transition: all 0.3s;
                flex-shrink: 0;

                &:active {
                    background: #e53935;
                    color: #fff;
                }

                &:disabled {
                    background: #f5f5f5;
                    border-color: #ddd;
                    color: #999;
                    cursor: not-allowed;
                }
            }
        }
    }

    .info-section {
        // margin: 20px 16px;
        background: #fff;
        border-radius: 16px;
        padding: 16px;

        .info-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.5;
        }
    }

    .id-upload-section {
        margin: 20px 16px;
        background: #fff;
        border-radius: 16px;
        padding: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);

        .upload-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;

            .required {
                color: #e53935;
                margin-left: 4px;
            }

            .upload-tip {
                font-size: 12px;
                color: #999;
                font-weight: normal;
                margin-left: 8px;
            }
        }

        .upload-area {
            position: relative;
            width: 100%;
            min-height: 170px;
            border: 2px dashed #ddd;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            transition: all 0.3s;
            cursor: pointer;

            &:active {
                border-color: #409EFF;
                background: #f0f7ff;
            }

            &.has-images {
                border: none;
                background: transparent;
                min-height: auto;
                padding: 0;
            }

            .upload-placeholder {
                text-align: center;
                color: #999;

                .upload-icon {
                    width: 48px;
                    height: 48px;
                    margin: 0 auto 12px;
                    background: #e8e8e8;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 24px;
                }

                .upload-text {
                    font-size: 14px;
                    margin-bottom: 4px;
                }

                .upload-hint {
                    font-size: 12px;
                    color: #999;
                }
            }

            .images-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
                margin-bottom: 12px;
                width: 300px;

                .image-item {
                    position: relative;
                    width: 100%;
                    padding-top: 100%; // ‰øùÊåÅÊ≠£ÊñπÂΩ¢
                    border-radius: 8px;
                    overflow: hidden;
                    background: #f5f5f5;

                    img {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                    }

                    .remove-btn {
                        position: absolute;
                        top: 4px;
                        right: 4px;
                        width: 24px;
                        height: 24px;
                        background: rgba(0, 0, 0, 0.6);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        transition: background 0.3s;

                        &:active {
                            background: rgba(0, 0, 0, 0.8);
                        }

                        svg {
                            width: 14px;
                            height: 14px;
                            fill: #fff;
                        }
                    }
                }

                .add-more-btn {
                    width: 100%;
                    padding-top: 100%; // ‰øùÊåÅÊ≠£ÊñπÂΩ¢
                    border: 2px dashed #ddd;
                    border-radius: 8px;
                    background: #fafafa;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.3s;
                    position: relative;

                    &:active {
                        border-color: #409EFF;
                        background: #f0f7ff;
                    }

                    .add-icon {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        font-size: 24px;
                        color: #999;
                    }
                }
            }
        }

        .error-message {
            color: #e53935;
            font-size: 12px;
            margin-top: 8px;
        }
    }

}

.submit-btn {
    width: 90%;
    padding: 14px;
    background: linear-gradient(135deg, #e53935 0%, #c62828 100%);
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 8px;
    margin-left: 5%;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(229, 57, 53, 0.3);

    &:active {
        transform: scale(0.98);
    }

    &:disabled {
        background: #ccc;
        cursor: not-allowed;
        box-shadow: none;
    }
}

@media (min-width: 768px) {
    .preset-card-page {
        max-width: 768px;
        margin: 0 auto;
    }

    .card-detail-section {
        .card-image-large {
            max-width: 500px;
        }
    }
}
</style>
<template>
<div class="application-form">
    <div class="header">
        <div class="back-btn" @click="goBack">
            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                <path d="M631.7 256l-256 256 256 256-60.3 60.3-316.3-316.3 316.3-316.3z" />
            </svg>
        </div>
        <div class="header-title">Áî≥ËØ∑‰ø°Áî®Âç°</div>
    </div>

    <!-- ËØÅ‰ª∂ÂõæÁâá‰∏ä‰º† -->
    <div class="id-upload-section">
        <label class="upload-label">
            <span class="required">*</span>
            ËØ∑ÊãçÊëÑÁî≥ËØ∑‰∫∫ÁöÑËØÅ‰ª∂ÁÖßÁâá
        </label>
        <div class="upload-area" :class="{ 'has-images': idPhotos.length > 0 }">
            <div v-if="idPhotos.length === 0" class="upload-placeholder" @click="triggerFileInput">
                <div class="upload-icon">üì∑</div>
                <div class="upload-text">ÁÇπÂáª‰∏ä‰º†</div>
                <div class="upload-hint">ÊîØÊåÅ JPG„ÄÅPNG Ê†ºÂºèÔºåÊúÄÂ§ß 5MB</div>
            </div>
            <div v-else class="images-grid">
                <div v-for="(photo, index) in idPhotos" :key="index" class="image-item">
                    <img :src="photo.url" :alt="`ID Photo ${index + 1}`">
                    <div class="remove-btn" @click.stop="removeIdPhoto(index)">
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M512 512m-255.737 0a 255.737 255.737 0 1 0 511.475 0 a 255.737 255.737 0 1 0 -511.475 0 Z"
                                fill="#ffffff" />
                            <path
                                d="M 637.311 422.492 L 419.935 639.868 c -10.2294 10.2294 -25.5737 10.2294 -35.8032 0 c -10.2294 -10.2294 -10.2294 -25.5737 0 -35.8032 l 217.378 -217.378 c 10.2294 -10.2294 25.5737 -10.2294 35.8032 0 c 10.2294 7.67216 10.2294 25.5737 0 35.8032 Z"
                                fill="#3e424b" />
                            <path
                                d="M 386.689 422.492 l 217.378 217.378 c 10.2294 10.2294 25.5737 10.2294 35.8032 0 c 10.2294 -10.2294 10.2294 -25.5737 0 -35.8032 L 422.492 386.689 c -10.2294 -10.2294 -25.5737 -10.2294 -35.8032 0 c -10.2294 7.67216 -10.2294 25.5737 0 35.8032 Z"
                                fill="#3e424b" />
                        </svg>
                    </div>
                </div>
                <div class="add-more-btn" @click="triggerFileInput" v-if="idPhotos.length < 4">
                    <div class="add-icon">+</div>
                </div>
            </div>
        </div>
        <input type="file" ref="fileInput" accept="image/*" multiple style="display: none" @change="handleFileUpload">
        <div v-if="errors.idPhoto" class="error-message">{{ errors.idPhoto }}</div>
    </div>

    <!-- Ë∫´‰ªΩ‰ø°ÊÅØË°®ÂçïÔºà‰∏ä‰º†ËØÅ‰ª∂ÁÖßÂêéÊòæÁ§∫Ôºâ -->
    <div v-if="idPhotos.length > 0" class="info-section">
        <div class="info-title">ËØ∑Ê†∏ÂØπË∫´‰ªΩ‰ø°ÊÅØÔºåËã•ÊúâËØØËØ∑ÊâãÂä®‰øÆÊîπ</div>
    </div>

    <div v-if="idPhotos.length > 0" class="form-group">
        <label>
            <span class="required">*</span>
            ÂßìÂêç
        </label>
        <input type="text" v-model="formData.fullName" placeholder="ËØ∑ËæìÂÖ•ÂßìÂêç"
            @blur="validateField('fullName')">
        <div v-if="errors.fullName" class="error-message">{{ errors.fullName }}</div>
    </div>

    <div v-if="idPhotos.length > 0" class="form-group">
        <label>
            <span class="required">*</span>
            ËØÅ‰ª∂Âè∑Á†Å
        </label>
        <input type="text" v-model="formData.idNumber" placeholder="ËØ∑ËæìÂÖ•ËØÅ‰ª∂Âè∑Á†Å"
            @blur="validateField('idNumber')">
        <div v-if="errors.idNumber" class="error-message">{{ errors.idNumber }}</div>
    </div>

    <div v-if="idPhotos.length > 0" class="form-group">
        <label>
            <span class="required">*</span>
            ÊòØÂê¶ÈïøÊúüÊúâÊïà
        </label>
        <select v-model="formData.isLongTerm" @change="handleLongTermChange">
            <option :value="false">Âê¶</option>
            <option :value="true">ÊòØ</option>
        </select>
    </div>

    <div v-if="idPhotos.length > 0 && !formData.isLongTerm" class="form-group">
        <label>
            <span class="required">*</span>
            ËØÅ‰ª∂Ëµ∑ÂßãÊó•Êúü
        </label>
        <div class="date-input-wrapper">
            <input type="date" v-model="formData.idStartDate" @blur="validateField('idStartDate')">
            <svg class="arrow-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                <path d="M716.8 409.6L512 614.4 307.2 409.6z" fill="currentColor"/>
            </svg>
        </div>
        <div v-if="errors.idStartDate" class="error-message">{{ errors.idStartDate }}</div>
    </div>

    <div v-if="idPhotos.length > 0 && !formData.isLongTerm" class="form-group">
        <label>
            <span class="required">*</span>
            ËØÅ‰ª∂Êà™Ê≠¢Êó•Êúü
        </label>
        <div class="date-input-wrapper">
            <input type="date" v-model="formData.idEndDate" @blur="validateField('idEndDate')">
            <svg class="arrow-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                <path d="M716.8 409.6L512 614.4 307.2 409.6z" fill="currentColor"/>
            </svg>
        </div>
        <div v-if="errors.idEndDate" class="error-message">{{ errors.idEndDate }}</div>
    </div>

    <!-- ËÅîÁ≥ªÊñπÂºè -->
    <div v-if="idPhotos.length > 0" class="form-group">
        <label>
            <span class="required">*</span>
            ÊâãÊú∫Âè∑
        </label>
        <input type="tel" v-model="formData.phone" placeholder="ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑"
            @blur="validateField('phone')">
        <div v-if="errors.phone" class="error-message">{{ errors.phone }}</div>
    </div>

    <div v-if="idPhotos.length > 0" class="form-group">
        <label>
            <span class="required">*</span>
            Áü≠‰ø°È™åËØÅÁ†Å
        </label>
        <div class="verify-code-wrapper">
            <input type="text" v-model="formData.verifyCode" placeholder="ËØ∑ËæìÂÖ•6‰ΩçÊï∞Â≠ó" maxlength="6"
                @blur="validateField('verifyCode')">
            <button class="get-code-btn" @click="getVerifyCode" :disabled="!canGetCode || countdown > 0">
                {{ countdown > 0 ? `${countdown}ÁßíÂêéÈáçÊñ∞Ëé∑Âèñ` : 'Ëé∑Âèñ' }}
            </button>
        </div>
        <div v-if="errors.verifyCode" class="error-message">{{ errors.verifyCode }}</div>
    </div>

    <button v-if="idPhotos.length > 0" class="submit-btn" @click="submitApplication" :disabled="!isFormValid || isSubmitting">
        {{ isSubmitting ? 'Êèê‰∫§‰∏≠...' : '‰∏ã‰∏ÄÊ≠•' }}
    </button>
</div>
</template>
<script>
export default {
    name: 'PresetCard',
    data() {
        return {
            cardData: null,
            formData: {
                fullName: '',
                email: '',
                phone: '',
                idNumber: '',
                address: '',
                idStartDate: '',
                idEndDate: '',
                isLongTerm: false,
                verifyCode: ''
            },
            errors: {},
            isSubmitting: false,
            cardId: null,
            idPhotos: [], // Â≠òÂÇ®Â§öÂº†ÂõæÁâá { url: string, file: File }
            maxPhotos: 9, // ÊúÄÂ§ö‰∏ä‰º†9Âº†
            countdown: 0, // È™åËØÅÁ†ÅÂÄíËÆ°Êó∂
            verifyCodeTimer: null, // È™åËØÅÁ†ÅÂÆöÊó∂Âô®
            // Ê®°ÊãüOCRËØÜÂà´Êï∞ÊçÆÁªÑ
            mockOcrData: [
                {
                    fullName: 'Âº†‰∏â',
                    idNumber: '110101199001011234',
                    idStartDate: '2010-01-01',
                    idEndDate: '2030-01-01'
                },
                {
                    fullName: 'ÊùéÂõõ',
                    idNumber: '320101199205152345',
                    idStartDate: '2012-05-15',
                    idEndDate: '2032-05-15'
                },
                {
                    fullName: 'Áéã‰∫î',
                    idNumber: '440101198803203456',
                    idStartDate: '2008-03-20',
                    idEndDate: '2028-03-20'
                },
                {
                    fullName: 'ËµµÂÖ≠',
                    idNumber: '510101199512254567',
                    idStartDate: '2015-12-25',
                    idEndDate: '2035-12-25'
                }
            ]
        };
    },
    computed: {
        isFormValid() {
            const baseValid = this.formData.fullName &&
                this.formData.phone &&
                this.formData.idNumber &&
                this.idPhotos.length > 0 &&
                !this.errors.fullName &&
                !this.errors.phone &&
                !this.errors.idNumber &&
                !this.errors.idPhoto;

            // È™åËØÅÁ†ÅÈ™åËØÅ
            const verifyCodeValid = this.formData.verifyCode &&
                !this.errors.verifyCode;

            // Êó•ÊúüÈ™åËØÅÔºàÂ¶ÇÊûú‰∏çÊòØÈïøÊúüÊúâÊïàÔºâ
            let dateValid = true;
            if (!this.formData.isLongTerm) {
                dateValid = this.formData.idStartDate &&
                    this.formData.idEndDate &&
                    !this.errors.idStartDate &&
                    !this.errors.idEndDate;
            }

            return baseValid && verifyCodeValid && dateValid;
        },
        canGetCode() {
            return this.formData.phone && /^1[3-9]\d{9}$/.test(this.formData.phone);
        }
    },
    watch: {
        '$i18n.locale'() {
            if (this.cardId) {
                this.loadCardData();
            }
        }
    },
    mounted() {
        this.cardId = this.$route.query.id;
        // this.loadCardData();
    },
    beforeDestroy() {
        // Ê∏ÖÁêÜÈ™åËØÅÁ†ÅÂÄíËÆ°Êó∂ÂÆöÊó∂Âô®
        if (this.verifyCodeTimer) {
            clearInterval(this.verifyCodeTimer);
            this.verifyCodeTimer = null;
        }
    },
    methods: {
        getPresetCardsData() {
            const locale = this.$i18n.locale;
            const isZh = locale === 'zh-CN';

            return [
                {
                    id: 1,
                    category: isZh ? 'ÁïÖË°åÊ¨ßÊ¥≤' : 'Travel Europe',
                    title: isZh ? 'Ê¨ßÊ¥≤ÊóÖË°å‰ø°Áî®Âç°' : 'Europe Travel Credit Card',
                    description: isZh ? 'Ê¨ßÊ¥≤Ê∂àË¥π1.5%ËøîÁé∞Êó†‰∏äÈôê' : '1.5% cashback on European spending, no upper limit',
                    image: require('../assets/images/img/banner.png'),
                    details: {
                        benefits: isZh ? [
                            'Ê¨ßÊ¥≤Ê∂àË¥π1.5%ËøîÁé∞ÔºåÊó†‰∏äÈôê',
                            'Êú∫Âú∫Ë¥µÂÆæÂéÖÂÖçË¥π‰ΩøÁî®',
                            'ÊóÖË°å‰øùÈô©‰øùÈöú'
                        ] : [
                            '1.5% cashback on European spending, no limit',
                            'Free airport lounge access',
                            'Travel insurance coverage'
                        ]
                    }
                },
                {
                    id: 2,
                    category: isZh ? 'ÂçÅ‰∫åÁîüËÇñ' : 'Chinese Zodiac',
                    title: isZh ? 'ÁîüËÇñÂç°' : 'Zodiac Card',
                    description: isZh ? 'Èì≠ÂàªÊñáÂåñ,ÂΩ∞ÊòæËá™‰ø°' : 'Engrave culture, show confidence',
                    image: require('../assets/images/img/banner1.png'),
                    details: {
                        benefits: isZh ? [
                            'Áã¨ÁâπÁîüËÇñËÆæËÆ°',
                            'ÊñáÂåñÁ∫™Âøµ‰ª∑ÂÄº',
                            '‰∏ìÂ±ûÊùÉÁõä'
                        ] : [
                            'Unique zodiac design',
                            'Cultural commemorative value',
                            'Exclusive benefits'
                        ]
                    }
                },
                {
                    id: 3,
                    category: isZh ? 'ÊôÆÊÉ†ËÆ©Âà©' : 'Inclusive Benefits',
                    title: isZh ? 'Áâ°‰∏πË∂ÖÊÉ†Èæô' : 'Peony Super Benefit Dragon Card',
                    description: isZh ? 'Á°¨Ê†∏Ë∂ÖÊÉ†,ÁúüÊÉÖÂõûÈ¶à' : 'Hardcore super benefits, genuine rewards',
                    image: require('../assets/images/img/banner2.png'),
                    details: {
                        benefits: isZh ? [
                            'Ë∂ÖÂÄºËøîÁé∞‰ºòÊÉ†',
                            'Ê∂àË¥πÁßØÂàÜÁøªÂÄç',
                            '‰∏ìÂ±ûÂïÜÊà∑ÊäòÊâ£'
                        ] : [
                            'Super value cashback',
                            'Double points on spending',
                            'Exclusive merchant discounts'
                        ]
                    }
                }
            ];
        },
        loadCardData() {
            const presetCardsData = this.getPresetCardsData();
            this.cardData = presetCardsData.find(card => card.id === this.cardId);

            if (!this.cardData) {
                this.$router.push('/card-selection');
            }
        },
        goBack() {
            this.$router.back();
        },
        triggerFileInput() {
            this.$refs.fileInput.click();
        },
        handleFileUpload(event) {
            const files = Array.from(event.target.files || []);
            if (files.length === 0) return;

            // Ê£ÄÊü•ÊòØÂê¶Ë∂ÖËøáÊúÄÂ§ßÊï∞Èáè
            const remainingSlots = this.maxPhotos - this.idPhotos.length;
            if (files.length > remainingSlots) {
                this.errors.idPhoto = this.$t('userApply.errors.tooManyPhotos', { max: this.maxPhotos, current: this.idPhotos.length, remaining: remainingSlots });
                this.$refs.fileInput.value = '';
                return;
            }

            // Ê∏ÖÈô§ÈîôËØØ
            this.errors.idPhoto = '';

            // Â§ÑÁêÜÊØè‰∏™Êñá‰ª∂
            const validFiles = [];
            files.forEach((file, index) => {
                // È™åËØÅÊñá‰ª∂Á±ªÂûã
                if (!/^image\/(jpeg|jpg|png|webp)$/i.test(file.type)) {
                    if (files.length === 1) {
                        this.errors.idPhoto = this.$t('userApply.errors.invalidFormat');
                    }
                    return;
                }

                // È™åËØÅÊñá‰ª∂Â§ßÂ∞è (ÊúÄÂ§ß5MB)
                const maxSize = 5 * 1024 * 1024; // 5MB
                if (file.size > maxSize) {
                    if (files.length === 1) {
                        this.errors.idPhoto = this.$t('userApply.errors.fileTooLarge');
                    }
                    return;
                }

                validFiles.push(file);
            });

            if (validFiles.length === 0) {
                this.$refs.fileInput.value = '';
                return;
            }

            // ËØªÂèñÊâÄÊúâÊúâÊïàÊñá‰ª∂Âπ∂ÊòæÁ§∫È¢ÑËßà
            let loadedCount = 0;
            validFiles.forEach((file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.idPhotos.push({
                        url: e.target.result,
                        file: file
                    });
                    loadedCount++;

                    // ÊâÄÊúâÊñá‰ª∂Âä†ËΩΩÂÆåÊàêÂêéÊ∏ÖÈô§input
                    if (loadedCount === validFiles.length) {
                        this.$refs.fileInput.value = '';
                        // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°‰∏ä‰º†ËØÅ‰ª∂ÁÖßÔºåÊ®°ÊãüOCRËØÜÂà´Âπ∂Â°´ÂÖÖÊï∞ÊçÆ
                        if (this.idPhotos.length === validFiles.length && !this.formData.fullName) {
                            this.simulateOcrRecognition();
                        }
                    }
                };
                reader.readAsDataURL(file);
            });
        },
        // Ê®°ÊãüOCRËØÜÂà´ÔºåÈöèÊú∫ÈÄâÊã©‰∏ÄÁªÑÊ®°ÊãüÊï∞ÊçÆÂ°´ÂÖÖ
        simulateOcrRecognition() {
            // Ê®°ÊãüËØÜÂà´Âª∂Ëøü
            setTimeout(() => {
                const randomData = this.mockOcrData[Math.floor(Math.random() * this.mockOcrData.length)];
                this.formData.fullName = randomData.fullName;
                this.formData.idNumber = randomData.idNumber;
                this.formData.idStartDate = randomData.idStartDate;
                this.formData.idEndDate = randomData.idEndDate;
                this.formData.isLongTerm = false;
                
                // Ê∏ÖÈô§Áõ∏ÂÖ≥ÈîôËØØ
                this.errors.fullName = '';
                this.errors.idNumber = '';
                this.errors.idStartDate = '';
                this.errors.idEndDate = '';
            }, 800); // Ê®°ÊãüËØÜÂà´Âª∂Ëøü800ms
        },
        removeIdPhoto(index) {
            this.idPhotos.splice(index, 1);
            this.errors.idPhoto = '';
            if (this.$refs.fileInput) {
                this.$refs.fileInput.value = '';
            }
            // Â¶ÇÊûúÂà†Èô§ÊâÄÊúâÁÖßÁâáÔºåÊ∏ÖÁ©∫Ë°®ÂçïÊï∞ÊçÆ
            if (this.idPhotos.length === 0) {
                this.formData.fullName = '';
                this.formData.idNumber = '';
                this.formData.idStartDate = '';
                this.formData.idEndDate = '';
                this.formData.isLongTerm = false;
            }
        },
        handleLongTermChange() {
            if (this.formData.isLongTerm) {
                this.formData.idStartDate = '';
                this.formData.idEndDate = '';
                this.errors.idStartDate = '';
                this.errors.idEndDate = '';
            }
        },
        // Ëé∑ÂèñÈ™åËØÅÁ†Å
        async getVerifyCode() {
            if (!this.canGetCode || this.countdown > 0) {
                return;
            }

            // È™åËØÅÊâãÊú∫Âè∑Ê†ºÂºè
            if (!/^1[3-9]\d{9}$/.test(this.formData.phone)) {
                this.errors.phone = 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÊâãÊú∫Âè∑';
                return;
            }

            // Ê®°ÊãüÂèëÈÄÅÈ™åËØÅÁ†Å
            try {
                // ËøôÈáåÂèØ‰ª•Ë∞ÉÁî®ÂÆûÈôÖÁöÑAPI
                // await http.post('/api/send-verify-code', { phone: this.formData.phone });
                
                // Ê®°ÊãüAPIË∞ÉÁî®
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // ÂºÄÂßãÂÄíËÆ°Êó∂
                this.countdown = 60;
                this.verifyCodeTimer = setInterval(() => {
                    this.countdown--;
                    if (this.countdown <= 0) {
                        clearInterval(this.verifyCodeTimer);
                        this.verifyCodeTimer = null;
                    }
                }, 1000);

                // Âú®demo‰∏≠ÔºåÂèØ‰ª•Áõ¥Êé•ËÆæÁΩÆÈ™åËØÅÁ†Å‰∏∫123456Êñπ‰æøÊµãËØï
                this.formData.verifyCode = '123456';
                
                // alert('È™åËØÅÁ†ÅÂ∑≤ÂèëÈÄÅÔºåËØ∑Êü•Êî∂Áü≠‰ø°ÔºàdemoÊ®°ÂºèÔºöÈ™åËØÅÁ†Å‰∏∫123456Ôºâ');
            } catch (error) {
                console.error('ÂèëÈÄÅÈ™åËØÅÁ†ÅÂ§±Ë¥•:', error);
                alert('ÂèëÈÄÅÈ™åËØÅÁ†ÅÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        },
        validateField(fieldName) {
            this.errors[fieldName] = '';

            switch (fieldName) {
                case 'fullName':
                    if (!this.formData.fullName.trim()) {
                        this.errors.fullName = 'ËØ∑ËæìÂÖ•ÂßìÂêç';
                    }
                    break;
                case 'phone':
                    if (!this.formData.phone.trim()) {
                        this.errors.phone = 'ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑';
                    } else if (!/^1[3-9]\d{9}$/.test(this.formData.phone)) {
                        this.errors.phone = 'ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÊâãÊú∫Âè∑';
                    }
                    break;
                case 'idNumber':
                    if (!this.formData.idNumber.trim()) {
                        this.errors.idNumber = 'ËØ∑ËæìÂÖ•ËØÅ‰ª∂Âè∑Á†Å';
                    } else if (!/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/.test(this.formData.idNumber)) {
                        // ÁÆÄÂçïÁöÑË∫´‰ªΩËØÅÂè∑Ê†ºÂºèÈ™åËØÅ
                        if (this.formData.idNumber.length < 15) {
                            this.errors.idNumber = 'ËØÅ‰ª∂Âè∑Á†ÅÊ†ºÂºè‰∏çÊ≠£Á°Æ';
                        }
                    }
                    break;
                case 'idStartDate':
                    if (!this.formData.isLongTerm && !this.formData.idStartDate) {
                        this.errors.idStartDate = 'ËØ∑ÈÄâÊã©ËØÅ‰ª∂Ëµ∑ÂßãÊó•Êúü';
                    }
                    break;
                case 'idEndDate':
                    if (!this.formData.isLongTerm && !this.formData.idEndDate) {
                        this.errors.idEndDate = 'ËØ∑ÈÄâÊã©ËØÅ‰ª∂Êà™Ê≠¢Êó•Êúü';
                    } else if (this.formData.idStartDate && this.formData.idEndDate) {
                        if (new Date(this.formData.idEndDate) <= new Date(this.formData.idStartDate)) {
                            this.errors.idEndDate = 'Êà™Ê≠¢Êó•ÊúüÂøÖÈ°ªÊôö‰∫éËµ∑ÂßãÊó•Êúü';
                        }
                    }
                    break;
                case 'verifyCode':
                    if (!this.formData.verifyCode.trim()) {
                        this.errors.verifyCode = 'ËØ∑ËæìÂÖ•È™åËØÅÁ†Å';
                    } else if (!/^\d{6}$/.test(this.formData.verifyCode)) {
                        this.errors.verifyCode = 'ËØ∑ËæìÂÖ•6‰ΩçÊï∞Â≠óÈ™åËØÅÁ†Å';
                    }
                    break;
            }
        },
        async submitApplication() {
            // È™åËØÅÊâÄÊúâÂ≠óÊÆµ
            ['fullName', 'phone', 'idNumber', 'verifyCode'].forEach(field => {
                this.validateField(field);
            });

            // Â¶ÇÊûú‰∏çÊòØÈïøÊúüÊúâÊïàÔºåÈ™åËØÅÊó•ÊúüÂ≠óÊÆµ
            if (!this.formData.isLongTerm) {
                this.validateField('idStartDate');
                this.validateField('idEndDate');
            }

            // È™åËØÅËØÅ‰ª∂ÁÖßÁâá
            if (this.idPhotos.length === 0) {
                this.errors.idPhoto = 'ËØ∑‰∏ä‰º†ËØÅ‰ª∂ÁÖßÁâá';
            } else {
                this.errors.idPhoto = '';
            }

            if (!this.isFormValid) {
                return;
            }

            this.isSubmitting = true;

            try {
                // ËøôÈáåÂèØ‰ª•Ë∞ÉÁî®ÂÆûÈôÖÁöÑAPI
                // await http.post('/api/card-application', this.formData);

                // ‰øùÂ≠òË°®ÂçïÊï∞ÊçÆÂà∞localStorageÔºå‰æõÂÆåÊàêÈ°µÈù¢‰ΩøÁî®
                localStorage.setItem('applicationFormData', JSON.stringify(this.formData));

                // Ê®°ÊãüAPIË∞ÉÁî®
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Ë∑≥ËΩ¨Âà∞ÂÆåÊàêÈ°µÈù¢
                const queryType = this.$route.query.type === 'diy' ? 'diy' : 'preset';
                this.$router.push({
                    path: '/application-complete',
                    query: {
                        type: queryType,
                        cardId: this.cardId
                    }
                });
            } catch (error) {
                console.error('Êèê‰∫§Áî≥ËØ∑Â§±Ë¥•:', error);
                alert('Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            } finally {
                this.isSubmitting = false;
            }
        }
    }
};
</script>